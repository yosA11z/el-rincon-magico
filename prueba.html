<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El rincon mágico-Crear cuenta</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- La librería de Supabase se carga aquí para que esté disponible -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8; /* Fondo ligeramente gris */
        }
        /* Estilos para el toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #FF6B00; /* Naranja para el estado activado */
        }
        input:focus + .slider {
            box-shadow: 0 0 1px #FF6B00;
        }
        input:checked + .slider:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }

        /* --- Estilos para la línea naranja del header --- */
        .header-link {
            position: relative; /* Necesario para posicionar el pseudo-elemento */
            display: inline-block; /* Asegura que el ancho sea el del texto */
        }

        .header-link::after {
            content: ''; /* Contenido vacío para el pseudo-elemento */
            position: absolute; /* Posicionamiento absoluto respecto al padre */
            width: 100%; /* Ocupa todo el ancho del enlace */
            height: 2px; /* Grosor de la línea */
            bottom: -5px; /* Ajusta la distancia desde el texto */
            left: 0;
            background-color: #FF6B00; /* ¡Cambiado a naranja! */
            transform: scaleX(0); /* Inicialmente invisible (ancho 0) */
            transition: transform 0.3s ease-out; /* Transición suave */
            transform-origin: left; /* La animación se origina desde la izquierda */
        }

        .header-link:hover::after {
            transform: scaleX(1); /* Al pasar el mouse, la línea se expande */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-white shadow-sm py-4 px-6 md:px-12 flex justify-between items-center">
        <div class="text-2xl font-bold text-gray-800">El Rincón Mágico</div>
        <nav class="hidden md:flex space-x-8 text-gray-600 font-medium">
            <a href="#" class="hover:text-gray-900 header-link">Inicio</a>
            <a href="index.html" class="hover:text-gray-900 header-link">Tienda</a>
            <a href="acerdade.html" class="hover:text-gray-900 header-link">Acerca de nosotros</a>
            <a href="contacto.html" class="hover:text-gray-900 header-link">Contacto</a>
        </nav>
        <div class="flex items-center space-x-6">
        </div>
    </header>

    <main class="flex-grow flex flex-col items-center justify-center p-4">
        <h1 class="text-3xl md:text-4xl font-semibold text-gray-800 mb-8 mt-4">Regístrate</h1>

        <div class="bg-white rounded-2xl shadow-lg flex flex-col lg:flex-row max-w-5xl w-full overflow-hidden">
            <div class="lg:w-1/2 p-8 flex items-center justify-center bg-white">
                <img src="registrarse-img.webp" 
                     alt="Ilustración de una persona en un carrito de compras" 
                     class="max-w-full h-auto rounded-lg"
                     onerror="this.onerror=null;this.src='https://placehold.co/500x400/F8F8F8/333333?text=Shopping+Illustration';">
            </div>

            <div class="lg:w-1/2 p-8 md:p-12 flex flex-col justify-center">
                <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 mb-6">Bienvenido de vuelta. Por favor, crea una cuenta para continuar.</h2>
                
                <div class="mb-4">
                    <input type="email" id="email" placeholder="tucorreo@gmail.com" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500">
                </div>

                <div class="mb-6">
                    <input type="password" id="password" placeholder="tu contraseña..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500" >
                </div>

                <div class="flex justify-between items-center mb-8">
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" class="hidden" checked>
                        <div class="toggle-switch">
                            <input type="checkbox" id="rememberPassword" checked>
                            <span class="slider"></span>
                        </div>
                    </label>
                </div>

                <!-- Div para mostrar mensajes al usuario -->
                <div id="message" class="mb-4 text-center text-sm font-medium"></div>

                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button id="signupButton" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md flex-grow transition duration-300 ease-in-out">Registrarse</button>
                    <a href="sigin.html" class="flex-grow text-center bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out">Ir a iniciar sesión</a>
                </div>
            </div>
        </div>
    </main>

    <!-- ¡IMPORTANTE! El script personalizado se coloca aquí, justo antes de cerrar </body> -->
    <script>
        // Inicializa el cliente de Supabase
        const SUPABASE_URL = 'https://bzeoxurommikbjbbbcfl.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6ZW94dXJvbW1pa2JqYmJiY2ZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1ODYwNTUsImV4cCI6MjA2OTE2MjA1NX0.19Xh5DJh49bvODOKVDBMgFBfJ1g9KIwE00BP_j7Y9VQ';
        
        // Asegúrate de que el objeto Supabase esté disponible antes de intentar usarlo
        if (typeof Supabase !== 'undefined') {
            const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            // Obtener elementos del DOM
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const signupButton = document.getElementById('signupButton');
            const messageDiv = document.getElementById('message');

            // Función para mostrar mensajes al usuario
            function displayMessage(text, type) {
                messageDiv.textContent = text;
                if (type === 'success') {
                    messageDiv.className = 'mb-4 text-center text-sm font-medium text-green-600';
                } else if (type === 'error') {
                    messageDiv.className = 'mb-4 text-center text-sm font-medium text-red-600';
                } else {
                    messageDiv.className = 'mb-4 text-center text-sm font-medium text-gray-700';
                }
            }

            // Manejar el evento de registro
            signupButton.addEventListener('click', async (event) => {
                event.preventDefault(); // Prevenir el envío por defecto del formulario

                const email = emailInput.value;
                const password = passwordInput.value;

                if (!email || !password) {
                    displayMessage('Por favor, ingresa tu correo y contraseña.', 'error');
                    return;
                }

                displayMessage('Registrando usuario...', 'info');
                signupButton.disabled = true; // Deshabilitar el botón durante el registro

                try {
                    const { data, error } = await supabase.auth.signUp({
                        email: email,
                        password: password,
                    });

                    if (error) {
                        // Manejar errores específicos de Supabase
                        if (error.message.includes('User already registered')) {
                            displayMessage('Este correo ya está registrado. Por favor, inicia sesión o usa otro correo.', 'error');
                        } else {
                            displayMessage(`Error al registrar: ${error.message}`, 'error');
                        }
                    } else if (data.user) {
                        displayMessage('¡Registro exitoso! Por favor, revisa tu correo para verificar tu cuenta.', 'success');
                        // Opcionalmente, redirigir después de un breve retraso
                        setTimeout(() => {
                            window.location.href = 'sigin.html'; // Redirigir a la página de inicio de sesión
                        }, 3000); 
                    } else {
                        // Este caso podría ocurrir si data.user es nulo pero no hay un objeto de error (ej. se necesita confirmación por correo)
                        displayMessage('Registro iniciado. Por favor, verifica tu correo electrónico para completar el proceso.', 'success');
                        setTimeout(() => {
                            window.location.href = 'sigin.html'; // Redirigir a la página de inicio de sesión
                        }, 3000);
                    }
                } catch (err) {
                    displayMessage(`Ocurrió un error inesperado: ${err.message}`, 'error');
                } finally {
                    signupButton.disabled = false; // Volver a habilitar el botón
                }
            });
        } else {
            // Mensaje si Supabase no se carga correctamente
            console.error("Error: La librería de Supabase no se cargó correctamente. 'Supabase' no está definido.");
            document.addEventListener('DOMContentLoaded', () => {
                const messageDiv = document.getElementById('message');
                if (messageDiv) {
                    messageDiv.textContent = 'Error: No se pudo cargar la funcionalidad de registro. Por favor, intenta de nuevo más tarde.';
                    messageDiv.className = 'mb-4 text-center text-sm font-medium text-red-600';
                }
            });
        }
    </script>
</body>
</html>