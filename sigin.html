<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El rincon mágico-Iniciar Sesión</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8; /* Fondo ligeramente gris */
        }
        /* Estilos para el toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #FF6B00; /* Naranja para el estado activado */
        }
        input:focus + .slider {
            box-shadow: 0 0 1px #FF6B00;
        }
        input:checked + .slider:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }

        /* --- Estilos para la línea amarilla del header --- */
        .header-link {
            position: relative; /* Necesario para posicionar el pseudo-elemento */
            display: inline-block; /* Asegura que el ancho sea el del texto */
        }

        .header-link::after {
            content: ''; /* Contenido vacío para el pseudo-elemento */
            position: absolute; /* Posicionamiento absoluto respecto al padre */
            width: 100%; /* Ocupa todo el ancho del enlace */
            height: 2px; /* Grosor de la línea */
            bottom: -5px; /* Ajusta la distancia desde el texto */
            left: 0;
            background-color: #FF6B00; /* Color amarillo */
            transform: scaleX(0); /* Inicialmente invisible (ancho 0) */
            transition: transform 0.3s ease-out; /* Transición suave */
            transform-origin: left; /* La animación se origina desde la izquierda */
        }

        .header-link:hover::after {
            transform: scaleX(1); /* Al pasar el mouse, la línea se expande */
        }

    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-white shadow-sm py-4 px-6 md:px-12 flex justify-between items-center">
        <div class="text-2xl font-bold text-gray-800">El Rincón Mágico</div>
        <nav class="hidden md:flex space-x-8 text-gray-600 font-medium">
            <a href="#" class="hover:text-gray-900 header-link">Inicio</a>
            <a href="index.html" class="hover:text-gray-900 header-link">Tienda</a>
            <a href="acerdade.html" class="hover:text-gray-900 header-link">Acerca de nosotros</a>
            <a href="contacto.html" class="hover:text-gray-900 header-link">Contacto</a>
        </nav>
        <div class="flex items-center space-x-6">
        </div>
    </header>

    <main class="flex-grow flex flex-col items-center justify-center p-4">
        <h1 class="text-3xl md:text-4xl font-semibold text-gray-800 mb-8 mt-4">Inicia sesión</h1>

        <div class="bg-white rounded-2xl shadow-lg flex flex-col lg:flex-row max-w-5xl w-full overflow-hidden">
            <div class="lg:w-1/2 p-8 flex items-center justify-center bg-white">
                <img src="login-img.avif" 
                     alt="Ilustración de una persona en un carrito de compras" 
                     class="max-w-full h-auto rounded-lg"
                     onerror="this.onerror=null;this.src='https://placehold.co/500x400/F8F8F8/333333?text=Shopping+Illustration';">
            </div>

            <div class="lg:w-1/2 p-8 md:p-12 flex flex-col justify-center">
                <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 mb-6">Bienvenido de vuelta. Por favor, inicia sesión en tu cuenta.</h2>

                <form autocomplete="on" id="loginForm" class="space-y-6">
  <div>
    <input 
      type="email" 
      name="email" 
      id="email"
      placeholder="tucorreo@gmail.com" 
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500" 
      required
    >
  </div>

  <div>
    <input 
      type="password" 
      name="password" 
      id="password"
      placeholder="tu contraseña..." 
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500" 
      required
    >
  </div>

  <div class="flex justify-between items-center">
    <label class="flex items-center space-x-2 cursor-pointer">
      <div class="toggle-switch">
        <input type="checkbox" id="rememberPassword">
        <span class="slider"></span>
      </div>
      <span class="text-gray-600 text-sm">Recordar correo</span>
    </label>

    <a href="#" id="forgotPasswordLink" class="text-red-500 text-sm font-medium hover:underline">
  ¿Olvidaste tu contraseña?
</a>

  </div>

  <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
    <button 
      type="submit"
      class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md flex-grow transition duration-300 ease-in-out"
    >
      Iniciar sesión
    </button>

    <a href="signup.html" class="flex-grow text-center bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out">
      Crear cuenta
    </a>
  </div>
</form>

            </div>
        </div>
    </main>
    <div id="resetModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 hidden">
  <div class="bg-white p-6 rounded-lg shadow-lg w-80 text-center">
    <h2 class="text-lg font-semibold mb-2">Restablecer contraseña</h2>
    <input id="resetEmail" type="email" placeholder="Ingresa tu correo" class="w-full border px-3 py-2 rounded mb-4" />
    <div class="flex justify-center space-x-2">
      <button id="sendResetBtn" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">
        Enviar
      </button>
      <button id="cancelResetBtn" class="bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded">
        Cancelar
      </button>
    </div>
  </div>
</div>

    <script>
    // Configuración de Supabase
    const SUPABASE_URL = 'https://bzeoxurommikbjbbbcfl.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6ZW94dXJvbW1pa2JqYmJiY2ZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1ODYwNTUsImV4cCI6MjA2OTE2MjA1NX0.19Xh5DJh49bvODOKVDBMgFBfJ1g9KIwE00BP_j7Y9VQ';

    const { createClient } = supabase;
    const client = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Obtener campos
    const emailInput = document.querySelector('input[type="email"]');
    const passwordInput = document.querySelector('input[type="password"]');
    const loginButton = document.querySelector('button'); // El primero es "Iniciar sesión"

    // Crear div de mensaje si no existe
    let messageDiv = document.getElementById('message');
    if (!messageDiv) {
        messageDiv = document.createElement('div');
        messageDiv.id = 'message';
        messageDiv.className = 'mb-4 text-center text-sm font-medium';
        loginButton.parentElement.insertBefore(messageDiv, loginButton);
    }

    // Función para mostrar mensajes
    function displayMessage(text, type) {
        messageDiv.textContent = text;
        if (type === 'success') {
            messageDiv.className = 'mb-4 text-center text-sm font-medium text-green-600';
        } else if (type === 'error') {
            messageDiv.className = 'mb-4 text-center text-sm font-medium text-red-600';
        } else {
            messageDiv.className = 'mb-4 text-center text-sm font-medium text-gray-700';
        }
    }

    // Manejar el evento de inicio de sesión
    loginButton.addEventListener('click', async (event) => {
        event.preventDefault();

        const email = emailInput.value;
        const password = passwordInput.value;

        if (!email || !password) {
            displayMessage('Por favor, completa los campos de correo y contraseña.', 'error');
            return;
        }

        displayMessage('Iniciando sesión...', 'info');
        loginButton.disabled = true;

        try {
            const { data, error } = await client.auth.signInWithPassword({
                email,
                password
            });

            if (error) {
                displayMessage(`Error al iniciar sesión: ${error.message}`, 'error');
            } else {
                displayMessage('¡Inicio de sesión exitoso! Redirigiendo...', 'success');
                setTimeout(() => {
                    window.location.href = 'index.html'; // Redirigir a la tienda o inicio
                }, 2000);
            }
        } catch (err) {
            displayMessage(`Error inesperado: ${err.message}`, 'error');
        } finally {
            loginButton.disabled = false;
        }
    });



    // Elemento del checkbox y del email
const rememberCheckbox = document.getElementById('rememberPassword');

// Al cargar la página, si hay un correo guardado, lo insertamos
document.addEventListener('DOMContentLoaded', () => {
    const savedEmail = localStorage.getItem('savedEmail');
    if (savedEmail) {
        emailInput.value = savedEmail;
        rememberCheckbox.checked = true;
    }
});

// Cuando cambia el checkbox, actualizamos localStorage
rememberCheckbox.addEventListener('change', () => {
    if (rememberCheckbox.checked && emailInput.value) {
        localStorage.setItem('savedEmail', emailInput.value);
    } else {
        localStorage.removeItem('savedEmail');
    }
});

// También actualizamos al hacer login exitoso
loginButton.addEventListener('click', async (event) => {
    event.preventDefault();

    const email = emailInput.value;
    const password = passwordInput.value;

    if (!email || !password) {
        displayMessage('Por favor, completa los campos de correo y contraseña.', 'error');
        return;
    }

    displayMessage('Iniciando sesión...', 'info');
    loginButton.disabled = true;

    try {
        const { data, error } = await client.auth.signInWithPassword({
            email,
            password
        });

        if (error) {
            displayMessage(`Error al iniciar sesión: ${error.message}`, 'error');
        } else {
            if (rememberCheckbox.checked) {
                localStorage.setItem('savedEmail', email);
            } else {
                localStorage.removeItem('savedEmail');
            }
            displayMessage('¡Inicio de sesión exitoso! Redirigiendo...', 'success');
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
        }
    } catch (err) {
        displayMessage(`Error inesperado: ${err.message}`, 'error');
    } finally {
        loginButton.disabled = false;
    }
});











const forgotPasswordLink = document.getElementById('forgotPasswordLink');
const resetModal = document.getElementById('resetModal');
const resetEmail = document.getElementById('resetEmail');
const sendResetBtn = document.getElementById('sendResetBtn');
const cancelResetBtn = document.getElementById('cancelResetBtn');

forgotPasswordLink.addEventListener('click', (e) => {
  e.preventDefault();
  resetEmail.value = emailInput.value || '';
  resetModal.classList.remove('hidden');
});

cancelResetBtn.addEventListener('click', () => {
  resetModal.classList.add('hidden');
});

sendResetBtn.addEventListener('click', async () => {
  const email = resetEmail.value.trim();

  if (!email) {
    displayMessage('Por favor ingresa un correo válido.', 'error');
    return;
  }

  try {
    const { data, error } = await client.auth.resetPasswordForEmail(email, {
      redirectTo: 'http://127.0.0.1:3000/resetpassword.html' // cámbialo por tu URL real
    });

    if (error) {
      displayMessage(`Error: ${error.message}`, 'error');
    } else {
      displayMessage('Correo enviado. Revisa tu bandeja de entrada.', 'success');
      resetModal.classList.add('hidden');
    }
  } catch (err) {
    displayMessage('Ocurrió un error inesperado.', 'error');
  }
});

</script>

</body>
</html>