<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>El Rincón Mágico - Crear cuenta</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f8f8f8;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: #FF6B00;
    }
    input:focus + .slider {
      box-shadow: 0 0 1px #FF6B00;
    }
    input:checked + .slider:before {
      transform: translateX(20px);
    }

    .header-link {
      position: relative;
      display: inline-block;
    }
    .header-link::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 2px;
      bottom: -5px;
      left: 0;
      background-color: #FF6B00;
      transform: scaleX(0);
      transition: transform 0.3s ease-out;
      transform-origin: left;
    }
    .header-link:hover::after {
      transform: scaleX(1);
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-white shadow-sm py-4 px-6 md:px-12 flex justify-between items-center">
    <div class="text-2xl font-bold text-gray-800">El Rincón Mágico</div>
    <nav class="hidden md:flex space-x-8 text-gray-600 font-medium justify-center flex-1">
      <a href="#" class="hover:text-gray-900 header-link">Inicio</a>
      <a href="index.html" class="hover:text-gray-900 header-link">Tienda</a>
      <a href="acerdade.html" class="hover:text-gray-900 header-link">Acerca de nosotros</a>
      <a href="contacto.html" class="hover:text-gray-900 header-link">Contacto</a>
    </nav>
  </header>

  <!-- Main -->
  <main class="flex-grow flex flex-col items-center justify-center p-4">
    <h1 class="text-3xl md:text-4xl font-semibold text-gray-800 mb-8 mt-4">Regístrate</h1>

    <div class="bg-white rounded-2xl shadow-lg flex flex-col lg:flex-row max-w-5xl w-full overflow-hidden">
      <!-- Imagen -->
      <div class="lg:w-1/2 p-8 flex items-center justify-center bg-white">
        <img src="registrarse-img.webp" 
             alt="Ilustración de una persona en un carrito de compras" 
             class="max-w-full h-auto rounded-lg"
             onerror="this.onerror=null;this.src='https://placehold.co/500x400/F8F8F8/333333?text=Shopping+Illustration';">
      </div>

      <!-- Formulario -->
      <div class="lg:w-1/2 p-8 md:p-12 flex flex-col justify-center">
        <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 mb-6">
          Bienvenido de vuelta. Por favor, crea una cuenta para continuar.
        </h2>
        
        <div class="mb-4">
          <input type="email" id="email" placeholder="tucorreo@gmail.com" 
                 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500">
        </div>

        <div class="mb-4">
          <input type="password" id="password" placeholder="tu contraseña..." 
                 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500">
        </div>

        <div class="mb-6">
          <input type="text" id="address" placeholder="tu dirección" 
                 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500">
        </div>

        <div class="flex justify-between items-center mb-8">
          <label class="flex items-center space-x-2 cursor-pointer">
            <input type="checkbox" class="hidden" checked>
            <div class="toggle-switch">
              <input type="checkbox" id="rememberPassword" checked>
            </div>
          </label>
        </div>

        <div id="message" class="mb-4 text-center text-sm font-medium"></div>

        <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
          <button id="signupButton" 
                  class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md flex-grow transition duration-300 ease-in-out">
            Registrarse
          </button>
          <a href="sigin.html" 
             class="flex-grow text-center bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out">
            Ir a iniciar sesión
          </a>
        </div>
      </div>
    </div>
  </main>

  <!-- Script de Supabase -->
  <script>
    const SUPABASE_URL = 'https://bzeoxurommikbjbbbcfl.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6ZW94dXJvbW1pa2JqYmJiY2ZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1ODYwNTUsImV4cCI6MjA2OTE2MjA1NX0.19Xh5DJh49bvODOKVDBMgFBfJ1g9KIwE00BP_j7Y9VQ';

    const { createClient } = supabase;
    const client = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const addressInput = document.getElementById('address');
    const signupButton = document.getElementById('signupButton');
    const messageDiv = document.getElementById('message');

    function displayMessage(text, type) {
      messageDiv.textContent = text;
      messageDiv.className = 'mb-4 text-center text-sm font-medium';
      if (type === 'success') messageDiv.classList.add('text-green-600');
      else if (type === 'error') messageDiv.classList.add('text-red-600');
      else messageDiv.classList.add('text-gray-700');
    }

    signupButton.addEventListener('click', async (e) => {
      e.preventDefault();

      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();
      const address = addressInput.value.trim();

      if (!email || !password || !address) {
        displayMessage('Por favor, ingresa tu correo, contraseña y dirección.', 'error');
        return;
      }

      displayMessage('Registrando usuario...', 'info');
      signupButton.disabled = true;

      try {
        const { data, error } = await client.auth.signUp({
          email,
          password,
          options: {
            data: {
              address
            }
          }
        });

        if (error) {
          if (error.message.includes('User already registered')) {
            displayMessage('Este correo ya está registrado.', 'error');
          } else {
            displayMessage(`Error: ${error.message}`, 'error');
          }
        } else {
          displayMessage('¡Registro exitoso! Revisa tu correo.', 'success');
          setTimeout(() => window.location.href = 'sigin.html', 3000);
        }
      } catch (err) {
        displayMessage(`Error inesperado: ${err.message}`, 'error');
      } finally {
        signupButton.disabled = false;
      }
    });
  </script>
</body>
</html>
